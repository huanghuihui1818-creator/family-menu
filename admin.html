<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>èœå•åå° â€” å®¶åº­èœå•</title>
  <style>
    body{font-family:system-ui;max-width:1000px;margin:20px auto;padding:12px;}
    .card{border:1px solid #eee;border-radius:10px;padding:12px;margin-bottom:12px}
    textarea{width:100%;min-height:360px;border:1px solid #ddd;border-radius:8px;padding:10px;font-family:ui-monospace,Menlo,Consolas,monospace}
    input,select{padding:8px;border-radius:8px;border:1px solid #ddd;width:100%}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    button{padding:8px 10px;border-radius:8px;border:1px solid #ddd;background:#fafafa;cursor:pointer}
    label{font-size:13px}
    .muted{color:#666;font-size:13px}
  </style>
</head>
<body>
  <h1>ğŸ§° èœå•åå°ï¼ˆç¼–è¾‘ & è¡¨å•åŠ èœï¼‰</h1>
  <div class="card">
    <div class="row">
      <button id="loadBtn">åŠ è½½å½“å‰ menu.json</button>
      <button id="validateBtn">æ ¡éªŒ JSON</button>
      <button id="exportBtn">å¯¼å‡º JSONï¼ˆå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼‰</button>
      <a href="./index.html" style="margin-left:auto">â† è¿”å›å‰ç«¯</a>
    </div>
    <p class="muted">è¯´æ˜ï¼šä¿®æ”¹å®Œæˆåï¼ŒæŠŠå¤åˆ¶çš„ JSON ç²˜è´´å› GitHub çš„ menu.json å¹¶ Commitï¼ŒCloudflare Pages ä¼šè‡ªåŠ¨ç”Ÿæ•ˆã€‚</p>
  </div>

  <div class="card">
    <label>menu.json å†…å®¹ï¼ˆç¼–è¾‘åè¯·æ ¡éªŒï¼‰</label>
    <textarea id="ta" placeholder="åŠ è½½åæ˜¾ç¤º"></textarea>
  </div>

  <div class="card">
    <h3>å¿«é€Ÿè¡¨å•ï¼šè¿½åŠ å•æ¡èœåˆ°æŒ‡å®šåˆ†ç±»ï¼ˆå®‰å…¨ï¼Œé¿å… JSON è¯­æ³•é”™ï¼‰</h3>
    <div class="row">
      <div style="flex:1">
        <label>åˆ†ç±» IDï¼ˆä¾‹å¦‚ï¼šmeat / veg / soup / stapleï¼‰</label>
        <input id="formCat" placeholder="ä¾‹å¦‚ï¼šmeat" />
        <label style="margin-top:8px">èœå</label>
        <input id="formName" placeholder="ä¾‹å¦‚ï¼šé±¼é¦™è‚‰ä¸" />
        <label style="margin-top:8px">ç±»å‹ï¼ˆè¤/ç´ /æ±¤/ä¸»é£Ÿï¼‰</label>
        <select id="formType">
          <option value="è¤">è¤</option>
          <option value="ç´ ">ç´ </option>
          <option value="æ±¤">æ±¤</option>
          <option value="ä¸»é£Ÿ">ä¸»é£Ÿ</option>
        </select>
      </div>
      <div style="width:260px">
        <label>æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰</label>
        <input id="formTags" placeholder="ä¾‹å¦‚ï¼šä¸‹é¥­,å¿«æ‰‹" />
        <label style="margin-top:8px">é¢„è®¡ç”¨æ—¶ï¼ˆåˆ†é’Ÿï¼‰</label>
        <input id="formTime" placeholder="ä¾‹å¦‚ï¼š25" />
        <label style="margin-top:8px">éš¾åº¦ï¼ˆ1-4ï¼‰</label>
        <input id="formDiff" placeholder="ä¾‹å¦‚ï¼š2" />
        <div style="margin-top:8px">
          <button id="appendBtn">â• è¿½åŠ åˆ° menu.json æ–‡æœ¬æ¡†</button>
        </div>
      </div>
    </div>
    <p class="muted">è¿½åŠ ä¼šæŠŠèœæ’å…¥åˆ° textarea çš„å¯¹åº”åˆ†ç±» items æ•°ç»„é‡Œã€‚å®Œæˆåè¯·ç‚¹â€œå¯¼å‡º JSONâ€å¤åˆ¶å¹¶å› GitHub ç²˜è´´è¦†ç›–ã€‚</p>
  </div>

  <script>
    const $ = id=>document.getElementById(id);
    $("loadBtn").onclick = async ()=>{
      try{
        const r = await fetch("./menu.json?v="+Date.now());
        const txt = await r.text();
        $("ta").value = txt;
        alert("å·²åŠ è½½ menu.jsonï¼ˆè¯·æ ¡éªŒåå¯¼å‡ºå¹¶ç²˜å› GitHubï¼‰");
      }catch(e){ alert("åŠ è½½å¤±è´¥ï¼Œè¯·ç¡®è®¤ menu.json åœ¨ä»“åº“æ ¹ç›®å½•"); }
    };
    $("validateBtn").onclick = ()=>{
      try{
        JSON.parse($("ta").value);
        alert("âœ… JSON æ ¡éªŒé€šè¿‡");
      }catch(e){ alert("âŒ JSON æœ‰è¯­æ³•é”™è¯¯ï¼š " + e.message); }
    };
    $("exportBtn").onclick = async ()=>{
      try{
        const obj = JSON.parse($("ta").value);
        const pretty = JSON.stringify(obj,null,2);
        await navigator.clipboard.writeText(pretty);
        alert("å·²å¤åˆ¶æ¼‚äº®çš„ JSON åˆ°å‰ªè´´æ¿ â†’ è¯·ç²˜å› GitHub menu.json å¹¶ Commit");
      }catch(e){ alert("æ— æ³•å¯¼å‡ºï¼ŒJSON è¯­æ³•é”™è¯¯ï¼š" + e.message); }
    };

    $("appendBtn").onclick = ()=>{
      try{
        const doc = JSON.parse($("ta").value || '{"categories":[]}');
        const catid = $("formCat").value.trim();
        if(!catid){ alert("è¯·å¡«å†™åˆ†ç±» ID"); return; }
        const cat = (doc.categories || []).find(c=>c.id===catid);
        if(!cat){ alert("æ‰¾ä¸åˆ°åˆ†ç±» IDï¼Œè¯·å…ˆåœ¨ menu.json ä¸­åˆ›å»ºè¯¥åˆ†ç±»å¹¶åŠ è½½"); return; }
        const name = $("formName").value.trim();
        if(!name){ alert("è¯·å¡«å†™èœå"); return; }
        const type = $("formType").value;
        const tags = ($("formTags").value||"").split(",").map(s=>s.trim()).filter(Boolean);
        const time = parseInt($("formTime").value||"0",10) || 0;
        const difficulty = parseInt($("formDiff").value||"1",10) || 1;
        const newItem = { name, type, tags, time, difficulty };
        cat.items = cat.items || [];
        cat.items.push(newItem);
        $("ta").value = JSON.stringify(doc, null, 2);
        alert("è¿½åŠ æˆåŠŸï¼šè®°å¾—ç‚¹â€œå¯¼å‡º JSONâ€å¹¶ç²˜å› GitHub ä¿å­˜");
        // æ¸…ç©ºè¡¨å•é¡¹
        $("formName").value=""; $("formTags").value=""; $("formTime").value=""; $("formDiff").value="";
      }catch(e){ alert("æ“ä½œå¤±è´¥ï¼Œè¯·å…ˆåŠ è½½å¹¶æ ¡éªŒ menu.jsonï¼š" + e.message); }
    };
  </script>
</body>
</html>
